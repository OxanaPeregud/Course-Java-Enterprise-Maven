<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         https://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet id="09" author="Oxana">
        <comment>Creating Procedure to Update Address</comment>
        <createProcedure dbms="h2, !oracle, mysql"
                         encoding="UTF-8"
                         procedureName="updateAddress"
                         relativeToChangelogFile="true"
                         schemaName="peopledb">
            CREATE PROCEDURE updateAddress(IN addressId INT,
            OUT house_number INT,
            OUT apartment_number INT)
            BEGIN
            UPDATE persondb.address
            SET persondb.address.house = persondb.address.house + 1
            WHERE id = addressId;
            SELECT persondb.address.house
            INTO house_number
            FROM persondb.address
            WHERE persondb.address.id = addressId;
            UPDATE persondb.address
            SET persondb.address.apartment = persondb.address.apartment + 2
            WHERE id = addressId;
            SELECT persondb.address.apartment
            INTO apartment_number
            FROM persondb.address
            WHERE persondb.address.address_id = addressId;
            END;
        </createProcedure>
    </changeSet>
</databaseChangeLog>